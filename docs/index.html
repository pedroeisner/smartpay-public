<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Smart Pay Onboarding</title>

<script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>

<style>
body {
background-color:#F2F2F7;
-webkit-font-smoothing:antialiased;
}

.chat-container{
height:calc(100vh - 140px);
overflow-y:auto;
scroll-behavior:smooth;
-webkit-overflow-scrolling:touch;
}

.chat-container::-webkit-scrollbar{display:none}

.fade-in{
animation:fadeIn .4s cubic-bezier(.25,1,.5,1)
}

@keyframes fadeIn{
from{opacity:0;transform:translateY(15px)}
to{opacity:1;transform:translateY(0)}
}

.scroll-mt-24{scroll-margin-top:96px}
</style>
</head>

<body>
<div id="root"></div>

<script type="text/babel">
const {useState,useEffect,useRef}=React;

const App=()=>{

const [messages,setMessages]=useState([]);
const [isTyping,setIsTyping]=useState(false);
const [step,setStep]=useState(0);
const [userMode,setUserMode]=useState(null);
const [hasSaved,setHasSaved]=useState(false);

const [selectedCards,setSelectedCards]=useState([]);
const [uiCardLogic,setUiCardLogic]=useState({});

const chatEndRef=useRef(null);
const lastMessageRef=useRef(null);
const activeStepRef=useRef(null);
const installShortcutRef=useRef(null);

useEffect(()=>{
if(lastMessageRef.current){
lastMessageRef.current.scrollIntoView({behavior:"smooth",block:"start"});
}
},[messages]);

// scroll after save for NEW USERS
useEffect(()=>{
if(hasSaved && userMode==="new" && installShortcutRef.current){
requestAnimationFrame(()=>{
setTimeout(()=>{
installShortcutRef.current.scrollIntoView({
behavior:"smooth",
block:"start"
});
},250);
});
}
},[hasSaved,userMode]);

const addBotMessage=(text,delay=600)=>{
setIsTyping(true);
setTimeout(()=>{
setIsTyping(false);
setMessages(p=>[...p,{sender:"bot",text}]);
},delay);
};

const addUserMessage=(text)=>setMessages(p=>[...p,{sender:"user",text}]);

const confirmLogic=async()=>{
addBotMessage("Saved! ðŸŽ‰");
setHasSaved(true);
};

return(
<div className="flex flex-col h-screen max-w-lg mx-auto bg-gray-100 shadow-xl overflow-hidden">

<header className="bg-white p-4 border-b text-center font-bold">
Smart Pay
</header>

<div className="flex-1 p-4 chat-container">

{messages.map((msg,i)=>(
<div key={i}
ref={i===messages.length-1?lastMessageRef:null}>
<div className={`mb-3 ${msg.sender==="bot"?"text-left":"text-right"}`}>
<span className={`inline-block px-4 py-2 rounded-xl ${msg.sender==="bot"?"bg-gray-200":"bg-blue-500 text-white"}`}>
{msg.text}
</span>
</div>
</div>
))}

{/* LOGIC STEP */}
{step===5 && !isTyping && (

<div className="mt-4 space-y-6 fade-in">

<div className="bg-white rounded-xl shadow">

<div className="p-4 border-b font-semibold">
Smart Rules
</div>

<div className="p-4">
<button
onClick={confirmLogic}
className="w-full bg-green-500 text-white py-3 rounded-xl font-bold">
Confirm & Save
</button>
</div>

</div>

{/* INSTALL CARD */}
{userMode==="new" && hasSaved && (

<div
ref={installShortcutRef}
className="bg-white p-5 rounded-xl shadow scroll-mt-24">

<h3 className="font-bold text-lg mb-3">
Install Shortcut
</h3>

<p className="mb-4 text-sm text-gray-600">
1. Click Get Shortcut.<br/>
2. In Shortcuts open Library and tap Smart Pay.
</p>

<a
href="#"
className="block w-full text-center bg-blue-500 text-white py-3 rounded-xl font-bold">
Get Shortcut
</a>

<div className="mt-4 border-t pt-4">
<a
href="#"
className="block w-full text-center border py-3 rounded-xl text-blue-600 font-semibold">
Send Backup Email
</a>
</div>

</div>

)}

</div>
)}

<div ref={chatEndRef}/>

</div>

</div>
);
};

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);

</script>
</body>
</html>
